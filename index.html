<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Playlist Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .player-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            color: white;
            margin-bottom: 30px;
        }

        .now-playing {
            text-align: center;
            margin-bottom: 20px;
        }

        .now-playing h2 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .now-playing p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.1s;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: white;
            color: #667eea;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .lists-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .list-box {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .list-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .song-item {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .song-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .song-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .song-info {
            flex: 1;
        }

        .song-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .song-artist {
            font-size: 0.85em;
            opacity: 0.7;
        }

        .song-duration {
            font-size: 0.9em;
            color: #666;
            margin-left: 10px;
        }

        .song-item.active .song-duration {
            color: white;
        }

        .delete-btn {
            background: #f56565;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s;
        }

        .delete-btn:hover {
            background: #e53e3e;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #999;
            font-style: italic;
        }

        .search-sort-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-sort-section input {
            flex: 1;
            min-width: 200px;
        }

        @media (max-width: 768px) {
            .controls {
                gap: 10px;
            }
            
            .btn {
                padding: 10px 18px;
                font-size: 0.9em;
            }
            
            h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ Music Playlist Manager</h1>
        <p class="subtitle">Circular Doubly Linked List ‚Ä¢ Queue (Recently Played - Max 4) ‚Ä¢ Queue (Upcoming)</p>

        <!-- Player Section -->
        <div class="player-section">
            <div class="now-playing">
                <h2 id="currentSong">No Song Playing</h2>
                <p id="currentArtist">Add songs to get started</p>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="rewind()">üîÅ Rewind</button>
                <button class="btn btn-secondary" onclick="previous()">‚èÆ Previous</button>
                <button class="btn btn-primary" id="playPauseBtn" onclick="togglePlayPause()">‚ñ∂Ô∏è Play</button>
                <button class="btn btn-secondary" onclick="next()">‚è≠ Next</button>
            </div>
        </div>

        <!-- Add Song Section -->
        <div class="input-section">
            <input type="text" id="songTitle" placeholder="Song Title" />
            <input type="text" id="artistName" placeholder="Artist Name" />
            <input type="number" id="duration" placeholder="Duration (seconds)" min="1" value="180" />
            <button class="btn btn-success" onclick="addSong()">‚ûï Add Song</button>
        </div>

        <!-- Search and Sort Section -->
        <div class="search-sort-section">
            <input type="text" id="searchInput" placeholder="üîé Search by title or artist..." onkeyup="searchSongs()" />
            <select id="sortType" onchange="sortPlaylist()">
                <option value="">Sort By...</option>
                <option value="title">Title (A-Z)</option>
                <option value="duration">Duration (Short to Long)</option>
            </select>
        </div>

        <!-- Lists Container -->
        <div class="lists-container">
            <!-- Main Playlist (Circular Doubly Linked List) -->
            <div class="list-box">
                <h3>üìÄ Main Playlist (CDLL)</h3>
                <div id="playlistView"></div>
            </div>

            <!-- Queue -->
            <div class="list-box">
                <h3>‚è≠ Next in Queue</h3>
                <div id="queueView"></div>
            </div>

            <!-- Stack (Last Played) -->
            <div class="list-box">
                <h3>üïê Recently Played</h3>
                <div id="stackView"></div>
            </div>
        </div>
    </div>

    <script>
        // ==================== Data Structures Implementation ====================
        
        // Node for Circular Doubly Linked List
        class SongNode {
            constructor(title, artist, duration) {
                this.title = title;
                this.artist = artist;
                this.duration = duration;
                this.next = null;
                this.prev = null;
            }
        }

        // Circular Doubly Linked List
        class CircularDoublyLinkedList {
            constructor() {
                this.head = null;
                this.current = null;
                this.size = 0;
            }

            add(title, artist, duration) {
                const newNode = new SongNode(title, artist, duration);
                
                if (!this.head) {
                    this.head = newNode;
                    newNode.next = newNode;
                    newNode.prev = newNode;
                    this.current = newNode;
                } else {
                    const tail = this.head.prev;
                    tail.next = newNode;
                    newNode.prev = tail;
                    newNode.next = this.head;
                    this.head.prev = newNode;
                }
                this.size++;
            }

            delete(title) {
                if (!this.head) return false;

                let node = this.head;
                let found = false;

                do {
                    if (node.title === title) {
                        found = true;
                        
                        if (this.size === 1) {
                            this.head = null;
                            this.current = null;
                        } else {
                            node.prev.next = node.next;
                            node.next.prev = node.prev;
                            
                            if (node === this.head) {
                                this.head = node.next;
                            }
                            if (node === this.current) {
                                this.current = node.next;
                            }
                        }
                        this.size--;
                        break;
                    }
                    node = node.next;
                } while (node !== this.head);

                return found;
            }

            next() {
                if (this.current) {
                    this.current = this.current.next;
                    return this.current;
                }
                return null;
            }

            previous() {
                if (this.current) {
                    this.current = this.current.prev;
                    return this.current;
                }
                return null;
            }

            rewind() {
                if (this.head) {
                    this.current = this.head;
                    return this.current;
                }
                return null;
            }

            toArray() {
                const arr = [];
                if (!this.head) return arr;

                let node = this.head;
                do {
                    arr.push(node);
                    node = node.next;
                } while (node !== this.head);

                return arr;
            }

            search(query) {
                const results = [];
                if (!this.head) return results;

                let node = this.head;
                const lowerQuery = query.toLowerCase();

                do {
                    if (node.title.toLowerCase().includes(lowerQuery) || 
                        node.artist.toLowerCase().includes(lowerQuery)) {
                        results.push(node);
                    }
                    node = node.next;
                } while (node !== this.head);

                return results;
            }

            bubbleSort(sortBy) {
                if (this.size <= 1) return;

                const arr = this.toArray();
                
                for (let i = 0; i < arr.length - 1; i++) {
                    for (let j = 0; j < arr.length - i - 1; j++) {
                        let swap = false;
                        
                        if (sortBy === 'title') {
                            swap = arr[j].title.toLowerCase() > arr[j + 1].title.toLowerCase();
                        } else if (sortBy === 'duration') {
                            swap = arr[j].duration > arr[j + 1].duration;
                        }
                        
                        if (swap) {
                            [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                        }
                    }
                }

                // Rebuild the list
                this.head = null;
                this.size = 0;
                arr.forEach(node => {
                    this.add(node.title, node.artist, node.duration);
                });
            }
        }

        // Queue for Recently Played (FIFO - max 4 songs)
        class RecentlyPlayedQueue {
            constructor() {
                this.items = [];
                this.maxSize = 4;
            }

            enqueue(song) {
                if (this.items.length >= this.maxSize) {
                    this.items.shift(); // Remove oldest song
                }
                this.items.push(song);
            }

            dequeue() {
                return this.items.shift();
            }

            isEmpty() {
                return this.items.length === 0;
            }

            toArray() {
                return [...this.items].reverse(); // Most recent first
            }
        }

        // Queue for Upcoming Songs (songs manually added to play next)
        class UpcomingQueue {
            constructor() {
                this.items = [];
            }

            enqueue(song) {
                this.items.push(song);
            }

            dequeue() {
                return this.items.shift();
            }

            isEmpty() {
                return this.items.length === 0;
            }

            clear() {
                this.items = [];
            }

            toArray() {
                return [...this.items];
            }
        }

        // ==================== Global Variables ====================
        
        const playlist = new CircularDoublyLinkedList();
        const recentlyPlayed = new RecentlyPlayedQueue();
        const upcomingQueue = new UpcomingQueue();
        
        let isPlaying = false;
        let currentProgress = 0;
        let progressInterval = null;
        let filteredResults = null;

        // ==================== Initialization ====================
        
        function initializePlaylist() {
            // Add some default songs
            playlist.add("Blinding Lights", "The Weeknd", 200);
            playlist.add("Shape of You", "Ed Sheeran", 233);
            playlist.add("Bohemian Rhapsody", "Queen", 354);
            playlist.add("Hotel California", "Eagles", 390);
            playlist.add("Imagine", "John Lennon", 183);
            
            updateUI();
            loadCurrentSong();
        }

        // ==================== Playback Functions ====================
        
        function togglePlayPause() {
            if (!playlist.current) {
                alert("No songs in playlist!");
                return;
            }

            isPlaying = !isPlaying;
            const btn = document.getElementById('playPauseBtn');
            
            if (isPlaying) {
                btn.innerHTML = '‚è∏ Pause';
                startProgress();
            } else {
                btn.innerHTML = '‚ñ∂Ô∏è Play';
                stopProgress();
            }
        }

        function startProgress() {
            if (progressInterval) clearInterval(progressInterval);
            
            progressInterval = setInterval(() => {
                if (!playlist.current) return;
                
                currentProgress += 0.1;
                
                if (currentProgress >= playlist.current.duration) {
                    currentProgress = 0;
                    playNext();
                }
                
                updateProgressBar();
            }, 100);
        }

        function stopProgress() {
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
        }

        function updateProgressBar() {
            if (!playlist.current) return;
            
            const percentage = (currentProgress / playlist.current.duration) * 100;
            document.getElementById('progress').style.width = percentage + '%';
            document.getElementById('currentTime').textContent = formatTime(currentProgress);
            document.getElementById('totalTime').textContent = formatTime(playlist.current.duration);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function loadCurrentSong() {
            if (!playlist.current) {
                document.getElementById('currentSong').textContent = 'No Song Playing';
                document.getElementById('currentArtist').textContent = 'Add songs to get started';
                return;
            }

            document.getElementById('currentSong').textContent = playlist.current.title;
            document.getElementById('currentArtist').textContent = playlist.current.artist;
            currentProgress = 0;
            updateProgressBar();
        }

        function playNext() {
            if (!upcomingQueue.isEmpty()) {
                // If there are songs in the queue, play them first
                const nextSong = upcomingQueue.dequeue();
                recentlyPlayed.enqueue(playlist.current);
                playlist.current = nextSong;
            } else {
                // Otherwise, move to next song in circular playlist
                recentlyPlayed.enqueue(playlist.current);
                playlist.next();
            }
            
            currentProgress = 0;
            loadCurrentSong();
            updateUI();
        }

        function next() {
            if (!playlist.current) return;
            playNext();
            if (isPlaying) {
                startProgress();
            }
        }

        function previous() {
            if (!playlist.current) return;
            
            // Simply go to previous song in circular playlist
            playlist.previous();
            
            currentProgress = 0;
            loadCurrentSong();
            updateUI();
            
            if (isPlaying) {
                startProgress();
            }
        }

        function rewind() {
            playlist.rewind();
            currentProgress = 0;
            recentlyPlayed.items = [];
            upcomingQueue.clear();
            loadCurrentSong();
            updateUI();
            
            if (isPlaying) {
                startProgress();
            }
        }

        // Add song to "Next in Queue" to play after current song
        function addToQueue(title) {
            let node = playlist.head;
            do {
                if (node.title === title && node !== playlist.current) {
                    upcomingQueue.enqueue(node);
                    updateUI();
                    break;
                }
                node = node.next;
            } while (node !== playlist.head);
        }

        // ==================== Playlist Management ====================
        
        function addSong() {
            const title = document.getElementById('songTitle').value.trim();
            const artist = document.getElementById('artistName').value.trim();
            const duration = parseInt(document.getElementById('duration').value);

            if (!title || !artist || !duration) {
                alert('Please fill all fields!');
                return;
            }

            playlist.add(title, artist, duration);
            
            document.getElementById('songTitle').value = '';
            document.getElementById('artistName').value = '';
            document.getElementById('duration').value = '180';
            
            if (!playlist.current) {
                loadCurrentSong();
            }
            
            updateUI();
        }

        function deleteSong(title) {
            if (playlist.current && playlist.current.title === title) {
                if (isPlaying) {
                    togglePlayPause();
                }
                playlist.next();
                loadCurrentSong();
            }
            
            playlist.delete(title);
            updateUI();
        }

        function playSong(title) {
            if (!playlist.head) return;
            
            let node = playlist.head;
            do {
                if (node.title === title) {
                    if (playlist.current) {
                        recentlyPlayed.enqueue(playlist.current);
                    }
                    playlist.current = node;
                    currentProgress = 0;
                    loadCurrentSong();
                    
                    if (!isPlaying) {
                        togglePlayPause();
                    } else {
                        startProgress();
                    }
                    
                    updateUI();
                    break;
                }
                node = node.next;
            } while (node !== playlist.head);
        }

        // ==================== Search and Sort ====================
        
        function searchSongs() {
            const query = document.getElementById('searchInput').value.trim();
            
            if (query === '') {
                filteredResults = null;
            } else {
                filteredResults = playlist.search(query);
            }
            
            updateUI();
        }

        function sortPlaylist() {
            const sortType = document.getElementById('sortType').value;
            
            if (!sortType) return;
            
            const wasPlaying = isPlaying;
            const currentSongTitle = playlist.current ? playlist.current.title : null;
            
            if (isPlaying) {
                togglePlayPause();
            }
            
            playlist.bubbleSort(sortType);
            
            // Restore current song
            if (currentSongTitle) {
                let node = playlist.head;
                do {
                    if (node.title === currentSongTitle) {
                        playlist.current = node;
                        break;
                    }
                    node = node.next;
                } while (node !== playlist.head);
            }
            
            updateUI();
            
            if (wasPlaying) {
                togglePlayPause();
            }
        }

        // ==================== UI Update ====================
        
        function updateUI() {
            updatePlaylistView();
            updateQueueView();
            updateStackView();
        }

        function updatePlaylistView() {
            const container = document.getElementById('playlistView');
            const songs = filteredResults !== null ? filteredResults : playlist.toArray();
            
            if (songs.length === 0) {
                container.innerHTML = '<div class="empty-state">No songs found</div>';
                return;
            }

            container.innerHTML = songs.map(song => `
                <div class="song-item ${song === playlist.current ? 'active' : ''}" onclick="playSong('${song.title}')">
                    <div class="song-info">
                        <div class="song-title">${song.title}</div>
                        <div class="song-artist">${song.artist}</div>
                    </div>
                    <span class="song-duration">${formatTime(song.duration)}</span>
                    <button class="delete-btn" onclick="event.stopPropagation(); addToQueue('${song.title}')" style="background: #48bb78; margin-right: 5px;">+Q</button>
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteSong('${song.title}')">‚úï</button>
                </div>
            `).join('');
        }

        function updateQueueView() {
            const container = document.getElementById('queueView');
            const songs = upcomingQueue.toArray();
            
            if (songs.length === 0) {
                container.innerHTML = '<div class="empty-state">Queue is empty</div>';
                return;
            }

            container.innerHTML = songs.map(song => `
                <div class="song-item">
                    <div class="song-info">
                        <div class="song-title">${song.title}</div>
                        <div class="song-artist">${song.artist}</div>
                    </div>
                    <span class="song-duration">${formatTime(song.duration)}</span>
                </div>
            `).join('');
        }

        function updateStackView() {
            const container = document.getElementById('stackView');
            const songs = recentlyPlayed.toArray();
            
            if (songs.length === 0) {
                container.innerHTML = '<div class="empty-state">No recently played songs</div>';
                return;
            }

            container.innerHTML = songs.map(song => `
                <div class="song-item">
                    <div class="song-info">
                        <div class="song-title">${song.title}</div>
                        <div class="song-artist">${song.artist}</div>
                    </div>
                    <span class="song-duration">${formatTime(song.duration)}</span>
                </div>
            `).join('');
        }

        // Progress bar click
        document.getElementById('progressBar').addEventListener('click', function(e) {
            if (!playlist.current) return;
            
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percentage = x / rect.width;
            currentProgress = percentage * playlist.current.duration;
            updateProgressBar();
        });

        // ==================== Initialize ====================
        
        initializePlaylist();
    </script>
</body>
</html>
